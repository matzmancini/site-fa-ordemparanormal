<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordem Paranormal</title>
    <link rel="shortcut icon" href="fotos/simb-medo.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>
    <nav>
        <a href="index.html">
            <img src="fotos/ordem-paranormal.png" alt="Ordem Paranormal">
        </a>
        <div>
            <a href="rpg.html">RPG</a>
            <a href="jogo.html">ENIGMA DO MEDO</a>
            <a href="livro.html">LIVROS</a>
        </div>
    </nav>

    <section id="apresentacao">
        <div>
            <h1>APRESENTAÇÃO</h1>
            <p>
                O <b>paranormal</b> não vem para a nossa <b>realidade</b> de maneira fácil. Ou, pelo menos, as coisas deveriam ser assim. <br> <br>
                O mundo em que vivemos não é o único. O universo que habitamos - a <b> Realidade</b> - é protegido por uma barreira invisível 
                denominada <b>Membrana</b>. Além dela, existe um lugar de insanidade e medo. Habitada <b>por forças malígnas</b>, essa dimensão é 
                conhecida como o <b>Outro Lado</b>. <br>
                A <b>Membrana</b> que separa a nossa <b>Realidade</b> do <b>Outro Lado</b> pode ser enfraquecida pelo <b>Medo</b>, e diversos grupos de <b>ocultistas</b> 
                estão dispostos a fazer o que for preciso para enfraquecer essa <b>Membrana</b> e invocar as entidades do <b>Outro Lado</b>. <br> <br>
                Por causa disso, uma organização de detetives paranormais foi criada: a <b>Ordo Realitas</b>. Vivendo vidas duplas, os agentes da 
                <b>Ordem</b> secretamente investigam e combatem o <b>paranormal</b>, protegendo a <b>Realidade</b> e lutando contra aqueles que estão apenas 
                dispostos a mergulhar o mundo em caos.
            </p>
            <p>
                <b>Ordem Paranormal</b> é um universo de investigação paranormal, criado por <b>Rafael "Cellbit" Lange</b>.
            </p>
            <button onclick="window.location.href='#ramos'">EXPLORE O UNIVERSO</button>
        </div>
        <div>
            <img src="fotos/outro-lado.png" alt="Símbolo do Outro Lado">
        </div>
    </section>

    <section id="sobre">
        <div>
            <img src="fotos/o-que-e.jpeg" alt="Desenho dos jogadores">
        </div>
        <div>
            <h1>O que é Ordem Paranormal?</h1>
            <p>
                <b>Ordem Paranormal</b> é um universo de investigação paranormal, com suas histórias contadas através de campanhas de RPG de mesa 
                com outros influenciadores em transmissões ao vivo nas plataformas <i>Twitch</i> e <i>YouTube</i>.
            </p>
        </div>
    </section>

    <section id="criador">
        <div>
            <img src="fotos/cellbit.jpeg" alt="Rafael 'Cellbit' Lange">
        </div>
        <div>
            <h1>O Criador</h1>
            <p>
                <b>Rafael Lange Severino</b>, mais conhecido como <b>Cellbit</b>, é um criador de conteúdo nas plataformas <i>YouTube</i> e <i>Twitch</i>. <br><br>
                Ele é o criador do universo de <b>Ordem Paranormal</b>, atuando como roterista e <b>Mestre</b> no RPG de mesa, além de ser o  
                <b>diretor criativo</b> do jogo <b>Enigma do Medo</b>, que também é ambientado no mesmo universo. <br><br>
                Como <b>Mestre</b> no RPG de Mesa, <b>Cellbit</b> é responsável pela atuação de todos os personagens não-jogáveis da série.
            </p>
        </div>
    </section>

    <section id="ramos">
        <h1>RAMIFICAÇÕES</h1>

        <a href="rpg.html">
            <div>
                <img src="fotos/rpg-mesa.jpeg" alt="RPG de Mesa">
                <h2>RPG de Mesa</h2>
            </div>
        </a>

        <a href="jogo.html">
            <div>
                <img src="fotos/enigma-medo.jpeg" alt="Enigma do Medo">
                <h2>Enigma do Medo</h2>
            </div>
        </a>

        <a href="livro.html">
            <div>
                <img src="fotos/quadrinhos.jpeg" alt="Livros">
                <h2>Livros e Quadrinhos</h2>
            </div>
        </a>
    </section>

    <footer id="footer">
        <div class="footer-content">

        <div class="footer-divider"></div>

            <div class="footer-icons">
                <a href="https://www.instagram.com/ordemparanormal/" target="_blank" class="social"><i class="fab fa-instagram"></i></a>
                <a href="https://x.com/ordemparanormal"  target="_blank" class="social"><i class="fab fa-twitter"></i></a>
                <a href="https://www.youtube.com/@OrdemParanormal"  target="_blank" class="social"><i class="fab fa-youtube"></i></a>
                <a href="https://jamboeditora.com.br/?post_type=product&s=Ordem+Paranormal&f_tax_product_labels=2010"  target="_blank" class="social"><i class="fas fa-store"></i></a>
                <a href="https://www.lolja.com.br/ordem-cellbit"  target="_blank" class="social"><i class="fas fa-tshirt"></i></a>
            </div>
        </div>

        <div class="footer-bottom">
            <p>© 2025 Ordem Paranormal. Todos os direitos reservados.</p>
        </div>
    </footer>

            <!-- Ícone do Chatbot -->
        <div id="chatbot-btn" onclick="abrirChat()">
        
        </div>

<!-- Chatbot floating button + modal (HTML + JS juntos) -->
<div id="n8n-chat-root">
  <!-- botão flutuante -->
  <button id="n8n-chat-btn" aria-label="Abrir chat"><img src="fotos/Logo_Ordo_Realitas.png" alt="Ordo Realitas"></button>

  <!-- modal do chat -->
  <div id="n8n-chat-modal" aria-hidden="true">
    <div id="n8n-chat-header">
      <span>Agente Auxiliar</span>
      <button id="n8n-chat-close" aria-label="Fechar">✕</button>
    </div>

    <div id="n8n-chat-messages" role="log" aria-live="polite"></div>

    <form id="n8n-chat-form" autocomplete="off">
      <input id="n8n-chat-input" type="text" placeholder="Escreva aqui..." />
      <button id="n8n-chat-send" type="submit">Enviar</button>
    </form>

    <div id="n8n-chat-footer">
      <small>Tire suas dúvidas sobre o universo de Ordem Paranormal</small>
    </div>
  </div>
</div>

<script>
/* ========== CONFIGURAÇÃO ========== */
/* Troque pelo seu webhook do n8n */
const N8N_WEBHOOK_URL = "https://tysokonakama.app.n8n.cloud/webhook/ordemparanormal";

/* Se precisar de token/Authorization: */
const AUTH_TOKEN = ""; // ex: "Bearer abc123" ou "Basic xxxx". Se vazio, não envia header

/* ================================================================================= */
/* JS do chat (não precisa alterar nada abaixo, salvo adaptações de payload)        */
/* ================================================================================= */

(function () {
  // elementos
  const btn = document.getElementById("n8n-chat-btn");
  const modal = document.getElementById("n8n-chat-modal");
  const closeBtn = document.getElementById("n8n-chat-close");
  const messagesEl = document.getElementById("n8n-chat-messages");
  const form = document.getElementById("n8n-chat-form");
  const input = document.getElementById("n8n-chat-input");

  // sessão simples (persistida)
  const SESSION_KEY = "n8n_chat_session_id";
  function getSessionId() {
    let id = localStorage.getItem(SESSION_KEY);
    if (!id) {
      id = "sess_" + Date.now() + "_" + Math.random().toString(36).slice(2, 9);
      localStorage.setItem(SESSION_KEY, id);
    }
    return id;
  }
  const sessionId = getSessionId();

  // util: criar bolha de mensagem
  function appendMessage(text, who = "bot", options = {}) {
    const wrap = document.createElement("div");
    wrap.className = "n8n-msg " + (who === "user" ? "user" : "bot");
    const bubble = document.createElement("div");
    bubble.className = "n8n-bubble";
    bubble.textContent = text;
    wrap.appendChild(bubble);
    if (options.timestamp !== false) {
      const ts = document.createElement("div");
      ts.className = "n8n-ts";
      ts.textContent = options.time || "";
      wrap.appendChild(ts);
    }
    messagesEl.appendChild(wrap);
    messagesEl.scrollTop = messagesEl.scrollHeight;
    return wrap;
  }

  // util: status de "digitando"
  function setTyping(active) {
    let el = document.getElementById("n8n-typing");
    if (active) {
      if (!el) {
        el = document.createElement("div");
        el.id = "n8n-typing";
        el.className = "n8n-msg bot typing";
        el.innerHTML = '<div class="n8n-bubble">Digitando<span class="dots">...</span></div>';
        messagesEl.appendChild(el);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }
    } else {
      if (el) el.remove();
    }
  }

  // toggle modal
  function openModal() {
    modal.setAttribute("aria-hidden", "false");
    modal.classList.add("open");
    btn.classList.add("active");
    input.focus();
  }
  function closeModal() {
    modal.setAttribute("aria-hidden", "true");
    modal.classList.remove("open");
    btn.classList.remove("active");
  }

  btn.addEventListener("click", () => {
    if (modal.classList.contains("open")) closeModal();
    else openModal();
  });
  closeBtn.addEventListener("click", closeModal);

  // enviar mensagem
  async function sendMessage(text) {
    if (!text || !text.trim()) return;
    const messageText = text.trim();
    // append do usuário
    appendMessage(messageText, "user", { time: new Date().toLocaleTimeString() });

    // limpar input
    input.value = "";
    input.disabled = true;
    setTyping(true);

    // construir payload - ajuste conforme seu workflow n8n
    const payload = {
      sessionId,
      message: messageText,
      timestamp: new Date().toISOString()
    };

    try {
      const headers = { "Content-Type": "application/json" };
      if (AUTH_TOKEN) headers["Authorization"] = AUTH_TOKEN;

      const resp = await fetch(N8N_WEBHOOK_URL, {
        method: "POST",
        headers,
        body: JSON.stringify(payload)
      });

      if (!resp.ok) {
        // tenta ler corpo para mensagem de erro
        let errText;
        try { errText = await resp.text(); } catch (e) { errText = resp.statusText; }
        appendMessage("Erro: " + (errText || resp.statusText || resp.status), "bot");
        console.error("n8n webhook error:", resp.status, errText);
      } else {
        // assume resposta JSON contendo { reply } ou { text }
        const contentType = resp.headers.get("content-type") || "";
        let data;
        if (contentType.includes("application/json")) {
          data = await resp.json();
        } else {
          data = { text: await resp.text() };
        }

        // preferências: procurar propriedades comuns
        const botText = (data.output) + "";
        appendMessage(botText, "bot", { time: new Date().toLocaleTimeString() });
      }
    } catch (err) {
      console.error("Erro ao conectar n8n:", err);
      appendMessage("Erro de conexão: verifique a URL do webhook / CORS / rede.", "bot");
    } finally {
      setTyping(false);
      input.disabled = false;
      input.focus();
    }
  }

  // form submit
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const v = input.value;
    if (!v.trim()) return;
    sendMessage(v);
  });

  // Enter para enviar, Shift+Enter para quebra
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      form.requestSubmit();
    }
  });

  // pequena mensagem de boas-vindas se a conversa estiver vazia
  function ensureWelcome() {
    if (!messagesEl.querySelector(".n8n-msg")) {
      appendMessage("Olá! Em que posso ajudar hoje?", "bot", { time: new Date().toLocaleTimeString() });
    }
  }

  ensureWelcome();

  // expose sendMessage para console (opcional)
  window.n8nChatSend = sendMessage;
})();
</script>

</body>
</html>